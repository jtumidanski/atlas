version:                                    '3.5'
services:
  nginx:
    build:
      context:                              .
      dockerfile:                           nginx.Dockerfile
    environment:
      LOGSPOUT:                             ignore
    networks:
      - wrg-net
      - clc-net
      - aos-net
      - cos-net
      - iis-net
      - mis-net
      - pos-net
      - csrv-net
      - mrg-net
      - morg-net
      - dis-net
      - drg-net
      - tds-net
      - eso-net
      - sis-net
      - ncs-net
      - cdc-net
      - bns-net
      - fec-net
      - csc-net
      - mdc-net
      - cks-net
      - nss-net
      - cac-net
      - cts-net
      - ros-net
      - party-net
    ports:
      - '80:80'
    expose:
      - '80'
    container_name:                         atlas-nginx
  db:
    build:
      context:                              .
      dockerfile:                           db.Dockerfile
    command:                                --default-authentication-plugin=mysql_native_password
    restart:                                always
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro
      - ../mysql:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD:                  the
      MYSQL_DATABASE:                       atlas
      LOGSPOUT:                             ignore
    ports:
      - '3306:3306'
    expose:
      - '3306'
    networks:
      - aos-net
      - cos-net
      - dis-net
      - eso-net
      - cks-net
      - nss-net
      - ros-net
    container_name:                         atlas-db
  wrg:
    image:                                  atlas-wrg:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "tds"
    ports:
      - '8581:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - wrg-net
    expose:
      - '8080'
    container_name:                         atlas-wrg
  clc:
    image:                                  atlas-clc:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "bns"
    ports:
      - '8484:8484'
    environment:
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - clc-net
    expose:
      - '8484'
    container_name:                         atlas-clc
  aos:
    image:                                  atlas-aos:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "db"
    ports:
      - '8583:40000'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-aos
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - aos-net
    expose:
      - '8080'
    container_name:                         atlas-aos
  cos:
    image:                                  atlas-cos:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "db"
    ports:
      - '8584:40000'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-cos
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - cos-net
    expose:
      - '8080'
    container_name:                         atlas-cos
  iis:
    image:                                  atlas-iis:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8585:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      WZ_DIR:                               /wz
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - iis-net
    expose:
      - '8080'
    container_name:                         atlas-iis
  mis:
    image:                                  atlas-mis:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8586:40000'
    environment:
      WAIT_HOSTS:                           nginx:80
      WZ_DIR:                               /wz
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - mis-net
    expose:
      - '8080'
    container_name:                         atlas-mis
  pos:
    image:                                  atlas-pos:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8587:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - pos-net
    expose:
      - '8080'
    container_name:                         atlas-pos
  mrg:
    image:                                  atlas-marg:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "tds"
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - mrg-net
    ports:
      - '8588:40000'
    container_name:                         atlas-mrg
  morg:
    image:                                  atlas-morg:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "tds"
    ports:
      - '8589:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - morg-net
    expose:
      - '8080'
    container_name:                         atlas-morg
  dis:
    image:                                  atlas-dis:latest
    depends_on:
      - "nginx"
      - "db"
    ports:
      - '8590:5005'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-dis
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - dis-net
    expose:
      - '8080'
    container_name:                         atlas-dis
  drg:
    image:                                  atlas-drg:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8591:40000'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - drg-net
    expose:
      - '8080'
    container_name:                         atlas-drg
  tds:
    image:                                  atlas-tds:latest
    depends_on:
      - "nginx"
    ports:
      - '8592:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - tds-net
    expose:
      - '8080'
    container_name:                         atlas-tds
  eso:
    image:                                  atlas-eso:latest
    depends_on:
      - "nginx"
      - "db"
    ports:
      - '8593:40000'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-eso
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - eso-net
    expose:
      - '8080'
    container_name:                         atlas-eso
  sis:
    image:                                  atlas-sis:latest
    depends_on:
      - "nginx"
    ports:
      - '8594:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      WZ_DIR:                               /wz
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - sis-net
    expose:
      - '8080'
    container_name:                         atlas-sis
  ncs:
    image:                                  atlas-ncs:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8595:40000'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - ncs-net
    expose:
      - '8080'
    container_name:                         atlas-ncs
  cdc:
    image:                                  atlas-cdc:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8596:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - cdc-net
    expose:
      - '8080'
    container_name:                         atlas-cdc
  bns:
    image:                                  atlas-bns:latest
    depends_on:
      - "nginx"
    ports:
      - '8597:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - bns-net
    expose:
      - '8080'
    container_name:                         atlas-bns
  fec:
    image:                                  atlas-fec:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8598:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - fec-net
    expose:
      - '8080'
    container_name:                         atlas-fec
  csc:
    image:                                  atlas-csc:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8599:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - csc-net
    expose:
      - '8080'
    container_name:                         atlas-csc
  mdc:
    image:                                  atlas-mdc:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8600:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - mdc-net
    expose:
      - '8080'
    container_name:                         atlas-mdc
  cks:
    image:                                  atlas-cks:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "db"
    ports:
      - '8601:5005'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-cks
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - cks-net
    expose:
      - '8080'
    container_name:                         atlas-cks
  nss:
    image:                                  atlas-nss:latest
    depends_on:
      - "nginx"
      - "db"
    ports:
      - '8602:5005'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      LOG_LEVEL:                            debug
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-nss
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - nss-net
    expose:
      - '8080'
    container_name:                         atlas-nss
  cac:
    image:                                  atlas-cac:latest
    depends_on:
      - "nginx"
    ports:
      - '8603:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - cac-net
    expose:
      - '8080'
    container_name:                         atlas-cac
  cts:
    image:                                  atlas-cts:latest
    depends_on:
      - "nginx"
    ports:
      - '8604:5005'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - cts-net
    expose:
      - '8080'
    container_name:                         atlas-cts
  ros:
    image:                                  atlas-ros:latest
    depends_on:
      - "nginx"
      - "kafka"
      - "db"
    ports:
      - '8605:40000'
    environment:
      WAIT_HOSTS:                           db:3306, nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      WZ_DIR:                               /wz
      DROP_DIR:                             /data/drops
      DB_USER:                              root
      DB_PASSWORD:                          the
      DB_HOST:                              atlas-db
      DB_PORT:                              3306
      DB_NAME:                              atlas-ros
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - ros-net
    expose:
      - '8080'
    container_name:                         atlas-ros
  party:
    image:                                  atlas-party:latest
    depends_on:
      - "nginx"
      - "kafka"
    ports:
      - '8606:40000'
    environment:
      WAIT_HOSTS:                           nginx:80
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - party-net
    expose:
      - '8080'
    container_name:                         atlas-party
  csrv-0-1:
    image:                                  atlas-wcc:latest
    depends_on:
      - "kafka"
      - "tds"
    ports:
      - '7575:7575'
    environment:
      HOST_ADDRESS:                         192.168.56.16
      WAIT_HOSTS:                           nginx:80, kafka:9092
      WORLD_ID:                             0
      CHANNEL_ID:                           1
      CHANNEL_PORT:                         7575
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - csrv-net
    expose:
      - '7575'
    container_name:                         atlas-csrv-0-1
    security_opt:
      - seccomp:unconfined
  csrv-0-2:
    image:                                  atlas-wcc:latest
    depends_on:
      - "kafka"
      - "tds"
    ports:
      - '7576:7576'
    environment:
      HOST_ADDRESS:                         192.168.56.16
      WAIT_HOSTS:                           nginx:80, kafka:9092
      WORLD_ID:                             0
      CHANNEL_ID:                           2
      CHANNEL_PORT:                         7576
      BOOTSTRAP_SERVERS:                    atlas-kafka:9092
      LOG_LEVEL:                            debug
      JAEGER_HOST_PORT:                     atlas-jaeger:6831
    networks:
      - csrv-net
    expose:
      - '7576'
    container_name:                         atlas-csrv-0-2
  zookeeper:
    image:                                  wurstmeister/zookeeper:3.4.6
    ports:
     - "2181:2181"
    networks:
      - kafka-net
    environment:
      LOGSPOUT:                             ignore
    container_name:                         atlas-zookeeper
  kafka:
    image:                                  wurstmeister/kafka:2.13-2.6.0
    ports:
      - '9092:9092'
    expose:
     - "9092"
    networks:
      - cos-net
      - pos-net
      - csrv-net
      - wrg-net
      - aos-net
      - mrg-net
      - morg-net
      - drg-net
      - ncs-net
      - cdc-net
      - clc-net
      - fec-net
      - csc-net
      - mdc-net
      - cks-net
      - cac-net
      - cts-net
      - ros-net
      - party-net
      - kafka-net
    environment:
      KAFKA_ADVERTISED_LISTENERS:           INSIDE://atlas-kafka:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT
      KAFKA_LISTENERS:                      INSIDE://0.0.0.0:9092
      KAFKA_INTER_BROKER_LISTENER_NAME:     INSIDE
      KAFKA_ZOOKEEPER_CONNECT:              zookeeper:2181
      KAFKA_AUTO_CREATE_TOPICS_ENABLE:      'true'
      LOGSPOUT:                             ignore
    container_name:                         atlas-kafka
  elasticsearch:
    image:                                  elasticsearch:1.5.2
    ports:
      - '9200:9200'
      - '9300:9300'
    environment:
      LOGSPOUT:                             ignore
    container_name:                         atlas-elasticsearch
  kibana:
    image:                                  kibana:4.1.2
    links:
      - elasticsearch
    environment:
        ELASTICSEARCH_URL:                  http://elasticsearch:9200
        LOGSPOUT:                           ignore
    ports:
      - '5601:5601'
    depends_on:
      - elasticsearch
    container_name:                         atlas-kibana
  logstash:
    image:                                  logstash:2.1.1
    environment:
      - STDOUT=true
      - LOGSPOUT=ignore
    links:
      - elasticsearch
    depends_on:
       - elasticsearch
       - kibana
    volumes:
      - ./logstash.conf:/etc/logstash/conf.d/logstash.conf:ro
    command:                                'logstash -f /etc/logstash/conf.d/logstash.conf'
    container_name:                         atlas-logstash
  logspout:
    image:                                  gliderlabs/logspout:v3
    command:                                'udp://logstash:5000'
    links:
      - logstash
    volumes:
      - '/var/run/docker.sock:/tmp/docker.sock'
    depends_on:
      - elasticsearch
      - logstash
      - kibana
    container_name:                         atlas-logspout
  jaeger:
    container_name:                         atlas-jaeger
    image:                                  jaegertracing/all-in-one:latest
    networks:
      - aos-net
      - bns-net
      - cac-net
      - cdc-net
      - cks-net
      - clc-net
      - cos-net
      - csc-net
      - cts-net
      - dis-net
      - drg-net
      - eso-net
      - fec-net
      - iis-net
      - mrg-net
      - mdc-net
      - mis-net
      - morg-net
      - ncs-net
      - nss-net
      - party-net
      - pos-net
      - ros-net
      - sis-net
      - tds-net
      - wcc-net
      - wrg-net
    ports:
      - 16686:16686
      - 14269:14269
networks:
  wrg-net:
    name:                                   wrg-net
  clc-net:
    name:                                   clc-net
  aos-net:
    name:                                   aos-net
  cos-net:
    name:                                   cos-net
  iis-net:
    name:                                   iis-net
  mis-net:
    name:                                   mis-net
  pos-net:
    name:                                   pos-net
  mrg-net:
    name:                                   mrg-net
  morg-net:
    name:                                   morg-net
  dis-net:
    name:                                   dis-net
  drg-net:
    name:                                   drg-net
  tds-net:
    name:                                   tds-net
  eso-net:
    name:                                   eso-net
  sis-net:
    name:                                   sis-net
  ncs-net:
    name:                                   ncs-net
  cdc-net:
    name:                                   cdc-net
  bns-net:
    name:                                   bns-net
  fec-net:
    name:                                   fec-net
  csc-net:
    name:                                   csc-net
  mdc-net:
    name:                                   mdc-net
  cks-net:
    name:                                   cks-net
  nss-net:
    name:                                   nss-net
  cac-net:
    name:                                   cac-net
  cts-net:
    name:                                   cts-net
  ros-net:
    name:                                   ros-net
  party-net:
    name:                                   party-net
  csrv-net:
    name:                                   csrv-net
  kafka-net:
    name:                                   kafka-net
